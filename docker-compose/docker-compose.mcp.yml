
networks:
  frontend:
    name: homeserver_frontend
  backend:
    name: homeserver_backend

services:
  # MCP Dashboard
  mcp-dashboard:
    build: ../mcp-servers/dashboard
    container_name: mcp-dashboard
    restart: unless-stopped
    networks:
      - frontend
    environment:
      - TZ=${TZ:-Europe/Berlin}
      - NODE_ENV=production
      - PORT=3000
      - MCP_API_KEY=${MCP_API_KEY}
      - ALLOWED_ORIGINS=${MCP_ALLOWED_ORIGINS:-http://localhost:3000}
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.mcp-dashboard.rule=Host(`mcp-dashboard.homeserver.local`)"
      - "traefik.http.routers.mcp-dashboard.entrypoints=web"
      - "traefik.http.services.mcp-dashboard.loadbalancer.server.port=3000"
    
  # MCP Filesystem
  mcp-fs:
    build: ../mcp-servers/filesystem
    container_name: mcp-fs
    restart: unless-stopped
    networks:
      - backend
      - frontend
    environment:
      - TZ=${TZ:-Europe/Berlin}
      - NODE_ENV=production
      - PORT=3001
      - MCP_API_KEY=${MCP_API_KEY}
      - ALLOWED_ORIGINS=${MCP_ALLOWED_ORIGINS:-http://localhost:3000}
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.mcp-fs.rule=Host(`mcp-fs.homeserver.local`)"
      - "traefik.http.routers.mcp-fs.entrypoints=web"
      - "traefik.http.services.mcp-fs.loadbalancer.server.port=3001"
    
  # MCP Docker
  mcp-docker:
    build: ../mcp-servers/docker
    container_name: mcp-docker
    restart: unless-stopped
    networks:
      - backend
      - frontend
    environment:
      - TZ=${TZ:-Europe/Berlin}
      - NODE_ENV=production
      - PORT=3002
      - MCP_API_KEY=${MCP_API_KEY}
      - ALLOWED_ORIGINS=${MCP_ALLOWED_ORIGINS:-http://localhost:3000}
      - DOCKER_HOST=tcp://docker-proxy:2375
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.mcp-docker.rule=Host(`mcp-docker.homeserver.local`)"
      - "traefik.http.routers.mcp-docker.entrypoints=web"
      - "traefik.http.services.mcp-docker.loadbalancer.server.port=3002"
    
  # MCP Database
  mcp-db:
    build: ../mcp-servers/database
    container_name: mcp-db
    restart: unless-stopped
    networks:
      - backend
      - frontend
    environment:
      - TZ=${TZ:-Europe/Berlin}
      - NODE_ENV=production
      - PORT=3003
      - MCP_API_KEY=${MCP_API_KEY}
      - ALLOWED_ORIGINS=${MCP_ALLOWED_ORIGINS:-http://localhost:3000}
      - POSTGRES_HOST=postgres
      - POSTGRES_USER=${MCP_POSTGRES_USER:-mcp_readonly}
      - POSTGRES_PASSWORD=${MCP_POSTGRES_PASSWORD}
      - POSTGRES_DB=${POSTGRES_DB:-homeserver}
      - MYSQL_HOST=mariadb
      - MYSQL_USER=${MCP_MYSQL_USER:-mcp_readonly}
      - MYSQL_PASSWORD=${MCP_MYSQL_PASSWORD}
      - MYSQL_DATABASE=${MYSQL_DATABASE:-homeserver}
      - REDIS_HOST=redis
      - REDIS_PASSWORD=${REDIS_PASSWORD}
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.mcp-db.rule=Host(`mcp-db.homeserver.local`)"
      - "traefik.http.routers.mcp-db.entrypoints=web"
      - "traefik.http.services.mcp-db.loadbalancer.server.port=3003"
    
  # MCP HTTP Client
  mcp-http:
    build: ../mcp-servers/http-client
    container_name: mcp-http
    restart: unless-stopped
    networks:
      - backend
      - frontend
    environment:
      - TZ=${TZ:-Europe/Berlin}
      - NODE_ENV=production
      - PORT=3004
      - MCP_API_KEY=${MCP_API_KEY}
      - ALLOWED_ORIGINS=${MCP_ALLOWED_ORIGINS:-http://localhost:3000}
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.mcp-http.rule=Host(`mcp-http.homeserver.local`)"
      - "traefik.http.routers.mcp-http.entrypoints=web"
      - "traefik.http.services.mcp-http.loadbalancer.server.port=3004"
